"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=_interopDefault(require("react"));function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}class AnimatedBase extends React.Component{constructor(e){super(e),this._ref=React.createRef()}componentDidMount(){mapCallbacks.call(this,null)}componentDidUpdate(e){let t;e.style!==this.props.style&&(Object.keys(e.style).forEach(n=>{t=e.style[n],this.props.style.hasOwnProperty(n)||t.instance.removeCallbackWithKey(n)}),mapCallbacks.call(this,t))}componentWillUnmount(){let e;Object.keys(this.props.style).forEach(t=>{"function"==typeof(e=this.props.style[t]).run&&e.instance.removeCallbackWithKey(t)})}render(){const e=this.props,{animatedProps:t,children:n,forwaredRef:r,style:i,type:a}=e,o=_objectWithoutProperties(e,["animatedProps","children","forwaredRef","style","type"]);return React.createElement(a,_objectSpread2({},o,{style:strip(i),ref:e=>{r&&(r.current=e),this._ref.current=e}}),n)}}function mapCallbacks(e){Object.keys(this.props.style).forEach(t=>{"function"==typeof(e=this.props.style[t]).run&&e.instance.addCallbackWithKey(t,e.run(this._ref.current,t))})}function strip(e){return Object.keys(e).reduce((t,n)=>("string"==typeof e[n]&&(t[n]=e[n]),t),{})}const AnimatedInstances={};var Animated=new Proxy(AnimatedBase,{get:(e,t)=>AnimatedInstances[t]||(AnimatedInstances[t]=React.forwardRef((e,n)=>{let{children:r}=e,i=_objectWithoutProperties(e,["children"]);return React.createElement(AnimatedBase,_extends({forwaredRef:n,type:t},i),r)}))});class Animation{get length(){return this._keys.length}get config(){return this._config}constructor(e,t){this._callbacks=new Map,this._done=!0,this._keys=[],this._values={},this._config=_objectSpread2({initialVelocity:0,friction:26,mass:1,precision:.01,tension:170,onEnd:noop},t);for(let t in e)this._values[t]={done:!1,toValue:e[t],lastPosition:e[t],lastTime:void 0,lastVelocity:void 0},this._keys.push(t)}removeCallbackWithKey(e){this._callbacks.delete(e)}addCallbackWithKey(e,t){this._callbacks.set(e,t)}onEnd(){this._done=!0,this._config.onEnd()}updateValue(){for(let[e,t]of this._callbacks)t(this._values)}set(e){for(let t in e)this._values.hasOwnProperty(t)&&this._values[t]!==e[t]&&(this._done=!1,this._values[t]=_objectSpread2({},this._values[t],{done:!1,lastVelocity:void 0,toValue:e[t]}))}get(e){return this._values[e].lastPosition}pause(){for(let e in this._values)this._values[e]=_objectSpread2({},this._values[e],{done:!0})}resume(){for(let e in this._values)this._values[e]=_objectSpread2({},this._values[e],{done:!1})}getValues(e){return this._values[this._keys[e]]}}function noop(){}class AnimationManager{static getInstance(){return AnimationManager._instance||(AnimationManager._instance=new AnimationManager)}constructor(){_defineProperty(this,"update",()=>{let e,t,n=!1,r=Date.now();for(let i=0;i<AnimationManager.QUEUE.length;i++){const a=AnimationManager.QUEUE[i];let o=a.config;e=!0;for(let i=0;i<a.length;i++){const s=a.getValues(i);if(s.done)continue;e=!1;let l=s.toValue,c=s.lastPosition,u=o.initialVelocity;if(o.easing)s.startTime||(s.from=s.lastPosition,s.startTime=r),c=o.easing((r-s.startTime)/o.duration)*(l-s.from),(n=r>=s.startTime+o.duration)&&(s.startTime=0);else{t=void 0!==s.lastTime?s.lastTime:r,u=void 0!==s.lastVelocity?s.lastVelocity:o.initialVelocity,r>t+64&&(t=r);let e=Math.floor(r-t);for(let t=0;t<e;++t){c+=1*(u+=1*((-o.tension*(c-l)+-o.friction*u)/o.mass)/1e3)/1e3}n=Math.abs(u)<=o.precision&&Math.abs(l-c)<=o.precision,s.lastVelocity=u,s.lastTime=r}n&&(s.value!==l&&(c=l),s.done=!0),s.lastPosition=c}a.updateValue(),e&&!a._done&&a.onEnd()}requestAnimationFrame(this.update)}),"function"==typeof requestAnimationFrame&&requestAnimationFrame(this.update)}add(e){return e instanceof Animation&&AnimationManager.QUEUE.push(e),this}remove(e){for(let t=0;t<AnimationManager.QUEUE.length;t++)AnimationManager.QUEUE[t]===e&&AnimationManager.QUEUE.splice(t,1);return this}}function useSpring(e,t){const n=React.useRef(null),[r,i]=React.useState(null);return n.current||(n.current=new Animation(e,t),AnimationManager.getInstance().add(n.current)),React.useEffect(()=>()=>{AnimationManager.getInstance().remove(n.current)},[]),[r||n.current,e=>{n.current.set(e),i(n.current)}]}function interpolate(e,t){return{instance:e,run:(e,n)=>-1===n.indexOf("--")?r=>{e.style[n]=t(r)}:r=>{e.style.setProperty(n,t(r))}}}_defineProperty(AnimationManager,"QUEUE",[]),_defineProperty(AnimationManager,"_instance",null),exports.Animated=Animated,exports.Animation=Animation,exports.AnimationManager=AnimationManager,exports.interpolate=interpolate,exports.useSpring=useSpring;