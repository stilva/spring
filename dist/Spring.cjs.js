"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=_interopDefault(require("react"));function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _createSuper(e){return function(){var t,r=_getPrototypeOf(e);if(_isNativeReflectConstruct()){var n=_getPrototypeOf(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return _possibleConstructorReturn(this,t)}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,i=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){a=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(a)throw o}}}}var AnimatedBase=function(e){_inherits(r,React.Component);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this,e))._ref=React.createRef(),n}return _createClass(r,[{key:"componentDidMount",value:function(){var e,t=this;Object.keys(this.props.style).forEach(function(r){"function"==typeof(e=t.props.style[r]).run&&e.instance.addCallbackWithKey(r,e.run(t._ref.current,r))})}},{key:"componentDidUpdate",value:function(e){var t,r=this;e.style!==this.props.style&&(Object.keys(e.style).forEach(function(n){t=e.style[n],r.props.style.hasOwnProperty(n)||t.instance.removeCallbackWithKey(n)}),Object.keys(this.props.style).forEach(function(e){"function"==typeof(t=r.props.style[e]).run&&t.instance.addCallbackWithKey(e,t.run(r._ref.current,e))}))}},{key:"componentWillUnmount",value:function(){var e,t=this;Object.keys(this.props.style).forEach(function(r){"function"==typeof(e=t.props.style[r]).run&&e.instance.removeCallbackWithKey(r)})}},{key:"render",value:function(){var e=this.props,t=e.children,r=e.type,n=(e.animatedProps,e.style),o=_objectWithoutProperties(e,["children","type","animatedProps","style"]);return React.createElement(r,_objectSpread2({},o,{style:strip(n),ref:this._ref}),t)}}]),r}();function strip(e){return Object.keys(e).reduce(function(t,r){return"string"==typeof e[r]&&(t[r]=e[r]),t},{})}var AnimatedInstances={},Animated=new Proxy(AnimatedBase,{get:function(e,t){return AnimatedInstances[t]||(AnimatedInstances[t]=React.forwardRef(function(e,r){var n=e.children,o=_objectWithoutProperties(e,["children"]);return React.createElement(AnimatedBase,_extends({ref:r,type:t},o),n)}))}}),AnimationManager=function(){function e(){var t=this;_classCallCheck(this,e),_defineProperty(this,"update",function(){for(var r=Date.now(),n=0;n<e.QUEUE.length;n++)for(var o=e.QUEUE[n],i=o.config,a=void 0,s=0;s<o.length;s++){var c=o.getValues(s);if(!c.done){var u=c.toValue,l=c.lastPosition,f=i.initialVelocity;a=void 0!==c.lastTime?c.lastTime:r,f=void 0!==c.lastVelocity?c.lastVelocity:i.initialVelocity,r>a+64&&(a=r);for(var y=Math.floor(r-a),p=0;p<y;++p){l+=1*(f+=1*((-i.tension*(l-u)+-i.friction*f)/i.mass)/1e3)/1e3}var h=Math.abs(f)<=i.precision,d=Math.abs(u-l)<=i.precision;c.lastVelocity=f,c.lastTime=r,h&&d&&(c.value!==u&&(l=u),c.done=!0),c.lastPosition=l,o.updateValue()}}requestAnimationFrame(t.update)}),"function"==typeof requestAnimationFrame&&requestAnimationFrame(this.update)}return _createClass(e,null,[{key:"getInstance",value:function(){return e._instance||(e._instance=new e)}}]),_createClass(e,[{key:"add",value:function(t){return t instanceof Animation&&e.QUEUE.push(t),this}},{key:"remove",value:function(t){for(var r=0;r<e.QUEUE.length;r++)e.QUEUE[r]===t&&e.QUEUE.splice(r,1);return this}}]),e}();_defineProperty(AnimationManager,"QUEUE",[]),_defineProperty(AnimationManager,"_instance",null);var Animation=function(){function e(t,r){for(var n in _classCallCheck(this,e),this._callbacks=new Map,this._keys=[],this._values={},this._config=_objectSpread2({initialVelocity:0,friction:26,mass:1,precision:.01,tension:170},r),t)this._values[n]={done:!1,toValue:t[n],lastPosition:t[n],lastTime:void 0,lastVelocity:void 0},this._keys.push(n)}return _createClass(e,[{key:"length",get:function(){return this._keys.length}},{key:"config",get:function(){return this._config}}]),_createClass(e,[{key:"removeCallbackWithKey",value:function(e){this._callbacks.delete(e)}},{key:"addCallbackWithKey",value:function(e,t){this._callbacks.set(e,t)}},{key:"updateValue",value:function(){var e,t=_createForOfIteratorHelper(this._callbacks);try{for(t.s();!(e=t.n()).done;){var r=_slicedToArray(e.value,2);r[0];(0,r[1])(this._values)}}catch(e){t.e(e)}finally{t.f()}}},{key:"set",value:function(e){for(var t in e)this._values.hasOwnProperty(t)&&this._values[t]!==e[t]&&(this._values[t]=_objectSpread2({},this._values[t],{done:!1,lastVelocity:void 0,toValue:e[t]}))}},{key:"getValues",value:function(e){return this._values[this._keys[e]]}}]),e}();function useSpring(e,t){var r=React.useRef(null),n=_slicedToArray(React.useState(null),2),o=n[0],i=n[1];return r.current||(r.current=new Animation(e,t),AnimationManager.getInstance().add(r.current)),React.useEffect(function(){return function(){AnimationManager.getInstance().remove(r.current)}},[]),[o||r.current,function(e){r.current.set(e),i(r.current)}]}function interpolate(e,t){return{instance:e,run:function(e,r){return-1===r.indexOf("--")?function(n){e.style[r]=t(n)}:function(n){e.style.setProperty(r,t(n))}}}}exports.Animated=Animated,exports.Animation=Animation,exports.AnimationManager=AnimationManager,exports.interpolate=interpolate,exports.useSpring=useSpring;